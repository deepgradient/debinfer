<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian inference for the logistic growth model • deBInfer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian inference for the logistic growth model">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">deBInfer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/chytrid_dede_example.html">Bayesian inference for a population growth model of the chytrid fungus</a>
    </li>
    <li>
      <a href="../articles/logistic_ode_example.html">Bayesian inference for the logistic growth model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pboesu/debinfer">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Bayesian inference for the logistic growth model</h1>
                        <h4 class="author">Philipp H Boersch-Supan, Sadie J Ryan, and Leah R Johnson</h4>
            
            <h4 class="date">September 2016</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pboesu/debinfer/blob/master/vignettes/logistic_ode_example.Rmd"><code>vignettes/logistic_ode_example.Rmd</code></a></small>
      <div class="hidden name"><code>logistic_ode_example.Rmd</code></div>

    </div>

    
    
<div id="preliminaries" class="section level1">
<h1 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h1>
<p>This vignette illustrates the steps needed to perform inference for an ODE model, the logistic growth model. A detailed description of the rationale behind the Bayesian inference approach for differential equations can be found in the paper describing the <code>deBInfer</code> package <span class="citation">(Boersch-Supan <em>et al.</em> 2017)</span>. The vignette also illustrates how to simulate noisy observations from an existing DE model. Conducting inference on a model with known parameters is good practice, when developing models for actual data, as it provides validation of the inference procedure.</p>
<p>This example assumes that <code>deBInfer</code> is installed and loaded. If this is not the case it needs to be installed from CRAN:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"deBInfer"</span>)</code></pre></div>
<p>Development versions of <code>deBInfer</code> are available on github, and can be installed using the devtools package <span class="citation">(Wickham &amp; Chang 2016)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="st">"devtools"</span>)){
  <span class="co">#install deBInfer from github</span>
  devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"pboesu/debinfer"</span>)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(deBInfer)</code></pre></div>
</div>
<div id="defining-the-de-model" class="section level1">
<h1 class="hasAnchor">
<a href="#defining-the-de-model" class="anchor"></a>Defining the DE model</h1>
We define a logistic growth model
<span class="math display">\[\begin{equation}\frac{dN}{dt}=rN\left(1-\frac{N}{K}\right).\end{equation}\]</span>
<p>and implement it for <code><a href="https://rdrr.io/pkg/deSolve/man/ode.html">deSolve::ode</a></code> <span class="citation">(Soetaert <em>et al.</em> 2010)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(deSolve)
logistic_model &lt;-<span class="st"> </span><span class="cf">function</span> (time, y, parms) {
    <span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(y, parms)), {
      dN &lt;-<span class="st"> </span>r <span class="op">*</span><span class="st"> </span>N <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>N <span class="op">/</span><span class="st"> </span>K)
      <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(dN)
      })
}</code></pre></div>
<p>We then pick a set of parameter values <span class="math inline">\((r=0.1, K=10)\)</span> and an initial condition (<span class="math inline">\(N=0.1\)</span>) and solve the model for these values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">N =</span> <span class="fl">0.1</span>)
parms &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">r =</span> <span class="fl">0.1</span>, <span class="dt">K =</span> <span class="dv">10</span>)
times &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="dv">120</span>, <span class="dv">1</span>)
out &lt;-<span class="st"> </span><span class="kw">ode</span>(y, times, logistic_model, parms, <span class="dt">method=</span><span class="st">"lsoda"</span>)</code></pre></div>
<p>We can plot this numerical solution.</p>
<p><img src="logistic_ode_example_files/figure-html/unnamed-chunk-1-1.png" width="1093.75"></p>
</div>
<div id="simulating-observations" class="section level1">
<h1 class="hasAnchor">
<a href="#simulating-observations" class="anchor"></a>Simulating observations</h1>
<p>Next we simulate a noisy dataset from this equation. We do this by sampling a random subset from the integration output</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">143</span>)
<span class="co">#force include the first time-point (t=0)</span>
N_obs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(out[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">35</span>, <span class="dv">0</span>, <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(out))),]) </code></pre></div>
<p>and we “add” lognormal noise with a known “observation” standard deviation <span class="math inline">\(\sigma^2_{obs}=0.05\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># add lognormal noise</span>
  parms[<span class="st">"sdlog.N"</span>] &lt;-<span class="st"> </span><span class="fl">0.05</span>
  N_obs<span class="op">$</span>N_noisy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Lognormal.html">rlnorm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(N_obs), <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(N_obs<span class="op">$</span>N),parms[<span class="st">"sdlog.N"</span>])
<span class="co">#observations must be ordered for solver to work</span>
N_obs &lt;-<span class="st"> </span>N_obs[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(N_obs<span class="op">$</span>time),]
<span class="co">#Plot true and noisy observations</span>
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(N_obs<span class="op">$</span>time, N_obs<span class="op">$</span>N, <span class="dt">ylim=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(N_obs<span class="op">$</span>N,N_obs<span class="op">$</span>N_noisy)))
<span class="kw"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(N_obs<span class="op">$</span>time, N_obs<span class="op">$</span>N_noisy, <span class="dt">col=</span><span class="st">"red"</span>)</code></pre></div>
<p><img src="logistic_ode_example_files/figure-html/unnamed-chunk-3-1.png" width="1093.75"></p>
</div>
<div id="defining-an-observation-model-and-parameters-for-inference" class="section level1">
<h1 class="hasAnchor">
<a href="#defining-an-observation-model-and-parameters-for-inference" class="anchor"></a>Defining an observation model and parameters for inference</h1>
<p>The appropriate log-likelihood for these data takes the form</p>
<span class="math display">\[\begin{equation}
\ell(\mathcal{Y}|\boldsymbol\theta) = \sum_t \ln\left(\frac{1}{\tilde{N_t}\sigma_{obs}\sqrt{2\pi}}\exp\left(-\frac{(\ln \tilde{N_t}-\ln (N_t+\varepsilon))^2}{2\sigma^2_{obs}}\right)\right)
\end{equation}\]</span>
<p>where <span class="math inline">\(\tilde{N}_t\)</span> are the observations, and <span class="math inline">\(N_t\)</span> are the predictions of the DE model given the current MCMC sample of the parameters <span class="math inline">\(\boldsymbol{\theta}\)</span>. Further, <span class="math inline">\(\varepsilon\)</span> is a small correction needed, because the DE solution can equal zero (or less, depending on numerical precision) <span class="citation">(Johnson <em>et al.</em> 2013)</span>. <span class="math inline">\(\varepsilon\)</span> should therefore be at least as large as the expected numerical precision of the solver. We chose <span class="math inline">\(\varepsilon= 10^{-6}\)</span>, which is on the same order as the default numerical precision of the default solver (<code><a href="https://rdrr.io/pkg/deSolve/man/ode.html">deSolve::ode</a></code> with <code>method = "lsoda"</code>), but we found that the inference results were insensitive to this choice as long as <span class="math inline">\(\varepsilon \leq 0.01\)</span> . A sensitivity analysis for <span class="math inline">\(\varepsilon\)</span> can be found at the end of this document.</p>
<p>This can be translated into an observation model function for <code>deBInfer</code>. The observation model function must have three named arguments <code>data</code>, <code>sim.data</code>, and <code>samp</code>, as these are used by the MCMC procedure to pass in the data (as a <code>data.frame</code>, i.e. indexed using the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator and the column names of the input data), the current state of the Markov chain (as a named vector), and the associated DE model solution (as a matrix-like object of class <code>deSolve</code>, i.e. indexed using the <code>[ ]</code> operator and the declared names of the state variables). We can access these inputs to define the data likelihood.</p>
<p>The user specifies the observation model such that it returns the summed log-likelihoods of the data. In this example the observations are in the data.frame column <code>N_noisy</code>, and the corresponding predicted states are in the column <code>N</code> of the matrix-like object<code>sim.data</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># the observation model</span>
  logistic_obs_model &lt;-<span class="st"> </span><span class="cf">function</span>(data, sim.data, samp){

    llik.N &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span>(data<span class="op">$</span>N_noisy, <span class="dt">meanlog =</span> <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(sim.data[,<span class="st">"N"</span>] <span class="op">+</span><span class="st"> </span><span class="fl">1e-6</span>), 
                       <span class="dt">sdlog =</span> samp[[<span class="st">"sdlog.N"</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>))
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(llik.N)
  }</code></pre></div>
<p>All parameters that are used in the DE model and the observation model need to be declared for the inference procedure using the <code><a href="../reference/debinfer_par.html">debinfer_par()</a></code> function. The declaration describes the variable name, whether it is a DE or observation parameter and whether or not it is to be estimated. If the parameter is to be estimated, the user also needs to specify a prior distribution and a number of additional parameters for the MCMC procedure. <code>deBInfer</code> currently supports priors from all probability distributions implemented in base R, as well as their truncated variants, as implemented in the <code>truncdist</code> package <span class="citation">(Novomestky &amp; Nadarajah 2012)</span>.</p>
<p>We declare the DE model parameter <span class="math inline">\(r\)</span>, assign a prior <span class="math inline">\(r \sim \mathcal{N}(0,1)\)</span> and a random walk sampler with a Normal kernel (<code>samp.type="rw"</code>) and proposal variance of 0.005. Similarly, we declare <span class="math inline">\(K\sim \ln\mathcal{N}(1,1)\)</span> and <span class="math inline">\(\ln(\sigma^2_{obs})\sim\mathcal{N}(0,1)\)</span>. Note that we are using the asymmetric uniform proposal distribution <span class="math inline">\(\mathcal{U}(\frac{a}{b}\theta^{(k)}, \frac{b}{a}\theta^{(k)})\)</span> for the variance parameter (<code>samp.type="rw-unif"</code>), as this ensures strictly positive proposals.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(deBInfer)
r &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"r"</span>, <span class="dt">var.type =</span> <span class="st">"de"</span>, <span class="dt">fixed =</span> <span class="ot">FALSE</span>,
                <span class="dt">value =</span> <span class="fl">0.5</span>, <span class="dt">prior =</span> <span class="st">"norm"</span>, <span class="dt">hypers =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>),
                <span class="dt">prop.var =</span> <span class="fl">0.0001</span>, <span class="dt">samp.type=</span><span class="st">"rw"</span>)

K &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"K"</span>, <span class="dt">var.type =</span> <span class="st">"de"</span>, <span class="dt">fixed =</span> <span class="ot">FALSE</span>,
                <span class="dt">value =</span> <span class="dv">5</span>, <span class="dt">prior =</span> <span class="st">"lnorm"</span>, <span class="dt">hypers =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">meanlog =</span> <span class="dv">1</span>, <span class="dt">sdlog =</span> <span class="dv">1</span>),
                <span class="dt">prop.var =</span> <span class="fl">0.1</span>, <span class="dt">samp.type =</span> <span class="st">"rw"</span>)

sdlog.N &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"sdlog.N"</span>, <span class="dt">var.type =</span> <span class="st">"obs"</span>, <span class="dt">fixed =</span> <span class="ot">FALSE</span>,
                <span class="dt">value =</span> <span class="fl">0.05</span>, <span class="dt">prior =</span> <span class="st">"lnorm"</span>, <span class="dt">hypers =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">meanlog =</span> <span class="dv">0</span>, <span class="dt">sdlog =</span> <span class="dv">1</span>),
                <span class="dt">prop.var =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>,<span class="dv">4</span>), <span class="dt">samp.type =</span> <span class="st">"rw-unif"</span>)</code></pre></div>
<p>Lastly, we provide an initial value <span class="math inline">\(N_0=0.1\)</span> for the DE:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">N &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"N"</span>, <span class="dt">var.type =</span> <span class="st">"init"</span>, <span class="dt">fixed =</span> <span class="ot">TRUE</span>, <span class="dt">value =</span> <span class="fl">0.1</span>)</code></pre></div>
<p>The declared parameters are then collated using the <code>setup_debinfer</code> function. Note that for models with more than one state variable, <strong>the initial values must be entered in the same order, as they are specified in the DE model function</strong>, as the solver matches these values by position, rather than by name. More details can be found in <code><a href="https://rdrr.io/pkg/deSolve/man/ode.html">?deSolve::ode</a></code>. The remaining parameters can be entered in any order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mcmc.pars &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setup_debinfer.html">setup_debinfer</a></span>(r, K, sdlog.N, N)</code></pre></div>
</div>
<div id="conduct-inference" class="section level1">
<h1 class="hasAnchor">
<a href="#conduct-inference" class="anchor"></a>Conduct inference</h1>
<p>Finally we use deBInfer to estimate the parameters of the original model. <code>de_mcmc</code> is the workhorse of the package and runs the MCMC estimation. The progress of the MCMC procedure can be monitored using the <code>cnt</code>, <code>plot</code> and <code>verbose</code> options: Every <code>cnt</code> iterations the function will print out information about the current state, and, if <code>plot=TRUE</code>, traceplots of the chains will be plotted. Setting <code>verbose=TRUE</code> will print additional information. Note that frequent plotting will substantially slow down the MCMC sampler, and should be used only on short runs when tuning the sampler.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># do inference with deBInfer</span>
  <span class="co"># MCMC iterations</span>
  iter &lt;-<span class="st"> </span><span class="dv">5000</span>
  <span class="co"># inference call</span>
  mcmc_samples &lt;-<span class="st"> </span><span class="kw"><a href="../reference/de_mcmc.html">de_mcmc</a></span>(<span class="dt">N =</span> iter, <span class="dt">data =</span> N_obs, <span class="dt">de.model =</span> logistic_model, 
                          <span class="dt">obs.model =</span> logistic_obs_model, <span class="dt">all.params =</span> mcmc.pars,
                          <span class="dt">Tmax =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(N_obs<span class="op">$</span>time), <span class="dt">data.times =</span> N_obs<span class="op">$</span>time, <span class="dt">cnt =</span> <span class="dv">500</span>, 
                          <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">verbose.mcmc =</span> <span class="ot">FALSE</span>, <span class="dt">solver =</span> <span class="st">"ode"</span>)</code></pre></div>
<p>We plot and summarize the MCMC chains</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(mcmc_samples)</code></pre></div>
<p><img src="logistic_ode_example_files/figure-html/unnamed-chunk-4-1.png" width="1200"></p>
<p>From the traceplot we can see that the burnin period extends through about 250 iterations. We can remove the burnin and have a look at parameter correlations using <code>pairs.debinfer_result</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">burnin &lt;-<span class="st"> </span><span class="dv">250</span>
<span class="kw"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span>(mcmc_samples, <span class="dt">burnin =</span> burnin, <span class="dt">scatter=</span><span class="ot">TRUE</span>, <span class="dt">trend=</span><span class="ot">TRUE</span>)</code></pre></div>
<p><img src="logistic_ode_example_files/figure-html/unnamed-chunk-5-1.png" width="1093.75"></p>
<p>And we can look at the overlap between the posterior and prior densities using <code>post_prior_densplot</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>))
<span class="kw"><a href="../reference/post_prior_densplot.html">post_prior_densplot</a></span>(mcmc_samples, <span class="dt">burnin =</span> burnin, <span class="dt">param =</span> <span class="st">"r"</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">v =</span> <span class="fl">0.1</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw"><a href="../reference/post_prior_densplot.html">post_prior_densplot</a></span>(mcmc_samples, <span class="dt">burnin =</span> burnin, <span class="dt">param =</span> <span class="st">"K"</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">v =</span> <span class="dv">10</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw"><a href="../reference/post_prior_densplot.html">post_prior_densplot</a></span>(mcmc_samples, <span class="dt">burnin =</span> burnin, <span class="dt">param =</span> <span class="st">"sdlog.N"</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">v =</span> <span class="fl">0.05</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="logistic_ode_example_files/figure-html/post-dens-1.png" width="1093.75"></p>
<p>Overlay the true underlying parameter values as vertical dashed lines shows that our estimation is recovering the true parameters.</p>
</div>
<div id="posterior-simulations" class="section level1">
<h1 class="hasAnchor">
<a href="#posterior-simulations" class="anchor"></a>Posterior simulations</h1>
<p>We then simulate DE model trajectories from the posterior and calculate the 95% highest posterior density interval for the deterministic part of the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">post_traj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/post_sim.html">post_sim</a></span>(mcmc_samples, <span class="dt">n=</span><span class="dv">500</span>, <span class="dt">times=</span><span class="dv">0</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">burnin=</span>burnin, <span class="dt">output =</span> <span class="st">"all"</span>, <span class="dt">prob =</span> <span class="fl">0.95</span>)</code></pre></div>
<p>We can visualise the median posterior trajectory and the associated highest posterior density interval using <code>plot.type="medianHDI"</code>. The <code>panel.first</code> option can be used to add the trajectory of the true model, which is stored in <code>out</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#median and HDI</span>
<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(post_traj, <span class="dt">plot.type =</span> <span class="st">"medianHDI"</span>, <span class="dt">lty =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"red"</span>,<span class="st">"grey20"</span>),
  <span class="dt">panel.first =</span> <span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(out, <span class="dt">col =</span> <span class="st">"darkblue"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
  )
  <span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topleft"</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"posterior median"</span>, <span class="st">"95% HDI"</span>, <span class="st">"true model"</span>),
  <span class="dt">lty =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="dt">lwd =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"red"</span>,<span class="st">"grey20"</span>,<span class="st">"darkblue"</span>),
  <span class="dt">bty =</span> <span class="st">"n"</span>)</code></pre></div>
<p><img src="logistic_ode_example_files/figure-html/post-sims-plot-1.png" width="1093.75"></p>
<p>Again, this confirms that the inference procedure does indeed recover the true model.</p>
<p>Lastly, we can plot an ensemble of posterior trajectories using <code>plot.type="ensemble"</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(post_traj, <span class="dt">plot.type =</span> <span class="st">"ensemble"</span>, <span class="dt">col =</span> <span class="st">"#FF000040"</span>)</code></pre></div>
<p><img src="logistic_ode_example_files/figure-html/post-sims-ensemble-1.png" width="1093.75"></p>
</div>
<div id="sensitivity-analysis-for-varepsilon" class="section level1">
<h1 class="hasAnchor">
<a href="#sensitivity-analysis-for-varepsilon" class="anchor"></a>Sensitivity analysis for <span class="math inline">\(\varepsilon\)</span>
</h1>
<p>Below is code to conduct a sensitivity analysis for the influence of the value of the correction factor <span class="math inline">\(\varepsilon\)</span> in the observation model on the posterior parameter estimates. (The vignette makes use of a precompiled figure instead of evaluating the following code, as the execution takes about 10 minutes on a modern desktop computer).</p>
<p>For this purpose we modify the observation model slightly, so that <span class="math inline">\(\varepsilon\)</span> can be passed in as an observation parameter, and we declare a corresponding <code>debinfer_par</code> with the name <code>epsilon</code> and add it to the parameter list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#reformulate the observation model such that epsilon is an observation parameter</span>
logistic_obs_model_eps &lt;-<span class="st"> </span><span class="cf">function</span>(data, sim.data, samp){
  
  llik.N &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span>(data<span class="op">$</span>N_noisy, <span class="dt">meanlog =</span> <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(sim.data[,<span class="st">"N"</span>] <span class="op">+</span><span class="st"> </span>samp[[<span class="st">"epsilon"</span>]]),
                       <span class="dt">sdlog =</span> samp[[<span class="st">"sdlog.N"</span>]], <span class="dt">log =</span> <span class="ot">TRUE</span>))
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(llik.N)
}

<span class="co">#declare epsilon</span>
epsilon &lt;-<span class="st"> </span><span class="kw"><a href="../reference/debinfer_par.html">debinfer_par</a></span>(<span class="dt">name =</span> <span class="st">"epsilon"</span>, <span class="dt">var.type =</span> <span class="st">"obs"</span>, <span class="dt">fixed =</span> <span class="ot">TRUE</span>,
                          <span class="dt">value =</span> <span class="fl">1e-6</span>)
    
<span class="co">#set up MCMC parameters</span>
mcmc.pars &lt;-<span class="st"> </span><span class="kw"><a href="../reference/setup_debinfer.html">setup_debinfer</a></span>(r, K, sdlog.N, epsilon, N)</code></pre></div>
<p>We can then manipulate the value of <code>epsilon</code> in list object <code>mcmc.pars</code> within an <code>lapply</code> call and conduct the inference for each value of <code>eps_range</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define a range of epsilon values</span>
eps_range &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1e-6</span>, <span class="fl">1e-5</span>, <span class="fl">1e-4</span>, <span class="fl">1e-3</span>, <span class="fl">1e-2</span>, <span class="fl">1e-1</span>)

<span class="co"># conduct inference for each value of eps_range</span>
eps_sims &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(eps_range, <span class="cf">function</span>(x){
  <span class="co">#reassign value of epsilon</span>
  mcmc.pars<span class="op">$</span>epsilon<span class="op">$</span>value &lt;-<span class="st"> </span>x
  eps_samples &lt;-<span class="st"> </span><span class="kw"><a href="../reference/de_mcmc.html">de_mcmc</a></span>(<span class="dt">N =</span> <span class="dv">10000</span>, <span class="dt">data =</span> N_obs, <span class="dt">de.model =</span> logistic_model,
                      <span class="dt">obs.model =</span> logistic_obs_model_eps, <span class="dt">all.params =</span> mcmc.pars,
                      <span class="dt">Tmax =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(N_obs<span class="op">$</span>time), <span class="dt">data.times =</span> N_obs<span class="op">$</span>time, <span class="dt">cnt =</span> <span class="dv">500</span>,
                      <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">solver =</span> <span class="st">"ode"</span>)
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(eps_samples)
})

<span class="co"># add names to the inference runs</span>
<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(eps_sims) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(eps_range)

<span class="co"># collate the samples in a data.frame for easy plotting while omitting </span>
<span class="co"># a burnin of 1000 samples</span>
eps_samps &lt;-<span class="st"> </span>plyr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/plyr/man/ldply.html">ldply</a></span>(eps_sims, <span class="cf">function</span>(x)(x<span class="op">$</span>samples[<span class="dv">1000</span><span class="op">:</span><span class="dv">10000</span>,]), <span class="dt">.id =</span> <span class="st">"epsilon"</span>)

<span class="co"># plot sensitivity analysis</span>
<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="dt">mar =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="dt">mgp =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.7</span>,<span class="fl">0.5</span>,<span class="dv">0</span>))
beanplot<span class="op">::</span><span class="kw">beanplot</span>(eps_samps<span class="op">$</span>r <span class="op">~</span><span class="st"> </span>eps_samps<span class="op">$</span>epsilon, <span class="dt">log =</span> <span class="st">""</span>, <span class="dt">what =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>), 
                   <span class="dt">col =</span> <span class="st">"darkgrey"</span>, <span class="dt">bw =</span> <span class="fl">2e-4</span>, <span class="dt">maxwidth =</span> <span class="fl">0.6</span>, <span class="dt">xlab =</span> <span class="st">"epsilon"</span>,
                   <span class="dt">ylab =</span> <span class="st">"r"</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottomleft"</span>, <span class="dt">legend =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"posterior mean"</span>, <span class="st">"true value"</span>), <span class="dt">lty =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>), 
       <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"black"</span>, <span class="st">"red"</span>), <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">bty =</span> <span class="st">"n"</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">h =</span> <span class="fl">0.1</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">3</span>)
beanplot<span class="op">::</span><span class="kw">beanplot</span>(eps_samps<span class="op">$</span>K <span class="op">~</span><span class="st"> </span>eps_samps<span class="op">$</span>epsilon, <span class="dt">log =</span> <span class="st">""</span>, <span class="dt">what =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>), 
                   <span class="dt">col =</span> <span class="st">"darkgrey"</span>, <span class="dt">bw =</span> <span class="fl">2e-2</span>, <span class="dt">maxwidth =</span> <span class="fl">0.6</span>, <span class="dt">xlab =</span> <span class="st">"epsilon"</span>
                   , <span class="dt">ylab =</span> <span class="st">"K"</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">h =</span> <span class="dv">10</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">3</span>)
beanplot<span class="op">::</span><span class="kw">beanplot</span>(eps_samps<span class="op">$</span>sdlog.N <span class="op">~</span><span class="st"> </span>eps_samps<span class="op">$</span>epsilon, <span class="dt">log=</span><span class="st">""</span>, <span class="dt">what=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>), 
                   <span class="dt">col =</span> <span class="st">"darkgrey"</span>, <span class="dt">bw =</span> <span class="fl">2e-3</span>, <span class="dt">maxwidth =</span> <span class="fl">0.6</span>, <span class="dt">xlab =</span> <span class="st">"epsilon"</span>,
                   <span class="dt">ylab =</span> <span class="st">"sdlog.N"</span>)
<span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">h =</span> <span class="fl">0.05</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">3</span>)</code></pre></div>
<div class="figure">
<embed src="epsilon-sensitivity.pdf"></embed><p class="caption">Influence of <span class="math inline">\(\varepsilon\)</span> on the posterior parameter estimates</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-deBInfer">
<p>Boersch-Supan, P.H., Ryan, S.J. &amp; Johnson, L.R. (2017). deBInfer: Bayesian inference for dynamical models of biological systems. <em>Methods in Ecology and Evolution</em>, <strong>8</strong>, 511–518.</p>
</div>
<div id="ref-johnson2013bayesian">
<p>Johnson, L.R., Pecquerie, L. &amp; Nisbet, R.M. (2013). Bayesian inference for bioenergetic models. <em>Ecology</em>, <strong>94</strong>, 882–894.</p>
</div>
<div id="ref-truncdist">
<p>Novomestky, F. &amp; Nadarajah, S. (2012). <em>Truncdist: Truncated random variables</em>.</p>
</div>
<div id="ref-soetaert2010solving">
<p>Soetaert, K., Petzoldt, T. &amp; Setzer, R.W. (2010). Solving differential equations in R: Package deSolve. <em>Journal of Statistical Software</em>, <strong>33</strong>, 1–25.</p>
</div>
<div id="ref-devtools">
<p>Wickham, H. &amp; Chang, W. (2016). <em>Devtools: Tools to make developing R packages easier</em>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#preliminaries">Preliminaries</a></li>
      <li><a href="#defining-the-de-model">Defining the DE model</a></li>
      <li><a href="#simulating-observations">Simulating observations</a></li>
      <li><a href="#defining-an-observation-model-and-parameters-for-inference">Defining an observation model and parameters for inference</a></li>
      <li><a href="#conduct-inference">Conduct inference</a></li>
      <li><a href="#posterior-simulations">Posterior simulations</a></li>
      <li><a href="#sensitivity-analysis-for-varepsilon">Sensitivity analysis for <span class="math inline">\(\varepsilon\)</span></a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Philipp H Boersch-Supan, Leah R Johnson, Sadie J Ryan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
